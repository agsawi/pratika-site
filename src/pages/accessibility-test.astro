---
import MainLayout from "../layouts/MainLayout.astro";
import { getVisualConfigWithAccessibility } from "../config/visual-config";

// Get the visual configuration with accessibility validation
const validationResult = getVisualConfigWithAccessibility();
const config = validationResult.config;
---

<MainLayout title="Accessibility Test | Visual System">
  <main class="mx-auto max-w-4xl px-4 py-8">
    <h1 class="text-4xl font-bold mb-8">Visual System Accessibility Test</h1>
    
    <!-- Configuration Status -->
    <section class="mb-8 p-6 border rounded-lg">
      <h2 class="text-2xl font-semibold mb-4">Configuration Status</h2>
      <div class="grid gap-4">
        <div class="flex items-center gap-2">
          <span class={`inline-block w-3 h-3 rounded-full ${validationResult.isValid ? 'bg-green-500' : 'bg-red-500'}`}></span>
          <span class="font-medium">
            {validationResult.isValid ? 'All critical colors meet WCAG AA standards' : 'Some colors need improvement'}
          </span>
        </div>
        
        {validationResult.accessibility.errors.length > 0 && (
          <div class="text-red-600">
            <strong>Errors:</strong> {validationResult.accessibility.errors.length}
          </div>
        )}
        
        {validationResult.accessibility.warnings.length > 0 && (
          <div class="text-yellow-600">
            <strong>Warnings:</strong> {validationResult.accessibility.warnings.length}
          </div>
        )}
      </div>
    </section>

    <!-- Color Samples -->
    <section class="mb-8">
      <h2 class="text-2xl font-semibold mb-4">Color Samples</h2>
      <div class="grid gap-4 md:grid-cols-2">
        
        <!-- Text on Background -->
        <div class="p-4 border rounded-lg" style={`background-color: ${config.colors.ui.background}; color: ${config.colors.ui.text}`}>
          <h3 class="font-semibold mb-2">Primary Text on Background</h3>
          <p>This is how primary text appears on the main background color. It should have sufficient contrast for readability.</p>
          <div class="text-sm mt-2 opacity-75">
            Text: {config.colors.ui.text} | Background: {config.colors.ui.background}
          </div>
        </div>

        <!-- Text on Surface -->
        <div class="p-4 border rounded-lg" style={`background-color: ${config.colors.ui.surface}; color: ${config.colors.ui.text}`}>
          <h3 class="font-semibold mb-2">Primary Text on Surface</h3>
          <p>This shows how text appears on surface elements like cards and modals.</p>
          <div class="text-sm mt-2 opacity-75">
            Text: {config.colors.ui.text} | Surface: {config.colors.ui.surface}
          </div>
        </div>

        <!-- Muted Text on Background -->
        <div class="p-4 border rounded-lg" style={`background-color: ${config.colors.ui.background}; color: ${config.colors.ui.textMuted}`}>
          <h3 class="font-semibold mb-2">Secondary Text on Background</h3>
          <p>This demonstrates secondary or muted text on the background. It should still be readable but less prominent.</p>
          <div class="text-sm mt-2 opacity-75">
            Text: {config.colors.ui.textMuted} | Background: {config.colors.ui.background}
          </div>
        </div>

        <!-- Brand Colors -->
        <div class="p-4 border rounded-lg" style={`background-color: ${config.colors.ui.background}`}>
          <h3 class="font-semibold mb-2">Brand Colors</h3>
          <div class="flex gap-2 mb-2">
            <div class="w-8 h-8 rounded" style={`background-color: ${config.colors.brand.primary}`} title="Primary"></div>
            <div class="w-8 h-8 rounded" style={`background-color: ${config.colors.brand.secondary}`} title="Secondary"></div>
            {config.colors.brand.accent && (
              <div class="w-8 h-8 rounded" style={`background-color: ${config.colors.brand.accent}`} title="Accent"></div>
            )}
          </div>
          <p class="text-sm">
            Primary: {config.colors.brand.primary} | 
            Secondary: {config.colors.brand.secondary}
            {config.colors.brand.accent && ` | Accent: ${config.colors.brand.accent}`}
          </p>
        </div>
      </div>
    </section>

    <!-- Semantic Colors -->
    <section class="mb-8">
      <h2 class="text-2xl font-semibold mb-4">Semantic Colors</h2>
      <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
        
        <div class="p-4 border rounded-lg" style={`background-color: ${config.colors.ui.background}; color: ${config.colors.ui.success}`}>
          <div class="font-semibold">Success</div>
          <div class="text-sm">{config.colors.ui.success}</div>
        </div>

        <div class="p-4 border rounded-lg" style={`background-color: ${config.colors.ui.background}; color: ${config.colors.ui.warning}`}>
          <div class="font-semibold">Warning</div>
          <div class="text-sm">{config.colors.ui.warning}</div>
        </div>

        <div class="p-4 border rounded-lg" style={`background-color: ${config.colors.ui.background}; color: ${config.colors.ui.error}`}>
          <div class="font-semibold">Error</div>
          <div class="text-sm">{config.colors.ui.error}</div>
        </div>

        <div class="p-4 border rounded-lg" style={`background-color: ${config.colors.ui.background}; color: ${config.colors.ui.info}`}>
          <div class="font-semibold">Info</div>
          <div class="text-sm">{config.colors.ui.info}</div>
        </div>
      </div>
    </section>

    <!-- Accessibility Report -->
    {!validationResult.isValid && (
      <section class="mb-8">
        <h2 class="text-2xl font-semibold mb-4">Accessibility Issues</h2>
        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
          <pre class="text-sm whitespace-pre-wrap font-mono">{validationResult.report}</pre>
        </div>
      </section>
    )}

    <!-- Instructions -->
    <section class="mb-8 p-6 bg-blue-50 border border-blue-200 rounded-lg">
      <h2 class="text-2xl font-semibold mb-4">Testing Instructions</h2>
      <div class="space-y-2">
        <p><strong>Command Line:</strong> Run <code class="bg-white px-2 py-1 rounded">npm run check-accessibility</code> for a detailed report</p>
        <p><strong>Configuration:</strong> Edit <code class="bg-white px-2 py-1 rounded">src/config/visual-config.json</code> to test different colors</p>
        <p><strong>CSS Generation:</strong> Run <code class="bg-white px-2 py-1 rounded">npm run generate-css</code> to regenerate styles with validation</p>
        <p><strong>Standards:</strong> WCAG AA requires 4.5:1 contrast for normal text, 3:1 for large text</p>
      </div>
    </section>
  </main>
</MainLayout>

<style>
  code {
    font-family: 'JetBrains Mono', 'Fira Code', monospace;
  }
</style>